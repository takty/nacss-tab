{"version":3,"sources":["tab-scroll.js"],"names":["window","NS","setClass","tar","cls","enabled","val","key","substr","startsWith","dataset","c","join","classList","add","remove","resizeListeners","onResize","fn","doFirst","push","isRunning","args","requestAnimationFrame","throttle","onIntersect","targets","threshold","rootMargin","vs","Array","length","fill","tm","Map","forEach","t","i","set","mt","io","st","s","getComputedStyle","document","documentElement","parseInt","scrollPaddingTop","Number","isNaN","getScrollOffset","clearTimeout","setTimeout","disconnect","IntersectionObserver","es","e","get","target","isIntersecting","replace","observe","init","onHashChanged","inst","getCurrentByHash","location","hash","active","update","create","cont","cid","opts","uls","hs","prefix","fh","container","cs","children","test","tagName","getFirstHeading","tn","elm","id","extractHeadings","hashPrefix","noHash","bars","h","idx","bar","curH","activate","ul","createElement","className","styleBar","styleActive","as","a","createAnchor","li","styleCurrent","appendChild","createBar","insertBefore","addEventListener","onClick","assignEvent","getElementById","indexOf","from","to","fromY","getBoundingClientRect","top","toR","y","height","innerHeight","scrollBy","find","getFirstVisible","href","title","innerText","innerHTML","querySelectorAll","spanning","replaceChild","l","passive","applyScroll","Object","assign","is"],"mappings":"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","file":"tab-scroll.min.js","sourcesContent":["/**\n * Tab Scroll\n *\n * @author Takuto Yanagida\n * @version 2021-12-26\n */\n\n'use strict';\n\nwindow['NACSS']        = window['NACSS']        || {};\nwindow['NACSS']['tab'] = window['NACSS']['tab'] || {};\n\n((NS) => {\n\n\t/**\n\t * Style Class Utilities\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-11-11\n\t */\n\t\n\tfunction hasClass(tar, cls) {\n\t\tconst key = cls.substr(1);\n\t\tif (cls.startsWith(':')) {\n\t\t\treturn tar.dataset[key] !== undefined;\n\t\t} else {\n\t\t\treturn tar.classList.contains(key);\n\t\t}\n\t}\n\t\n\tfunction setClass(tar, cls, enabled = true, val = '') {\n\t\tconst key = cls.substr(1);\n\t\tif (cls.startsWith(':')) {\n\t\t\tif (enabled) {\n\t\t\t\ttar.dataset[key] = val;\n\t\t\t} else {\n\t\t\t\tdelete tar.dataset[key];\n\t\t\t}\n\t\t} else {\n\t\t\tconst c = [key, val].join('-');\n\t\t\tif (enabled) {\n\t\t\t\ttar.classList.add(c);\n\t\t\t} else {\n\t\t\t\ttar.classList.remove(c);\n\t\t\t}\n\t\t}\n\t}\n\t\n\tfunction getSelector(cls) {\n\t\tif (cls.startsWith(':')) {\n\t\t\treturn `*[data-${cls.substr(1).replace(/([A-Z])/g, c => '-' + c.charAt(0).toLowerCase())}]`;\n\t\t} else {\n\t\t\treturn `*${cls}`;\n\t\t}\n\t}\n\t\n\t/**\n\t * Utilities\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-12-06\n\t */\n\t\n\tfunction getScrollOffset() {\n\t\tconst s   = getComputedStyle(document.documentElement);\n\t\tconst val = parseInt(s.scrollPaddingTop);\n\t\treturn Number.isNaN(val) ? 0 : val;\n\t}\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tfunction throttle(fn) {\n\t\tlet isRunning;\n\t\treturn (...args) => {\n\t\t\tif (isRunning) return;\n\t\t\tisRunning = true;\n\t\t\trequestAnimationFrame(() => {\n\t\t\t\tisRunning = false;\n\t\t\t\tfn(...args);\n\t\t\t});\n\t\t};\n\t}\n\t\n\tconst resizeListeners = [];\n\t\n\tfunction onResize(fn, doFirst = false) {\n\t\tif (doFirst) fn();\n\t\tresizeListeners.push(throttle(fn));\n\t}\n\t\n\tdocument.addEventListener('DOMContentLoaded', () => {\n\t\twindow.addEventListener('resize', () => {\n\t\t\tfor (const l of resizeListeners) l();\n\t\t}, { passive: true });\n\t});\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tfunction onIntersect(fn, targets, threshold = 0, rootMargin = '* 0px 0px 0px') {\n\t\tconst vs = Array(targets.length).fill(false);\n\t\tconst tm = new Map();\n\t\ttargets.forEach((t, i) => tm.set(t, i));\n\t\n\t\tfunction init() {\n\t\t\tconst io = new IntersectionObserver((es) => {\n\t\t\t\tfor (const e of es) vs[tm.get(e.target)] = e.isIntersecting;\n\t\t\t\tfn(vs);\n\t\t\t}, { rootMargin: rootMargin.replace('*', `${mt}px`), threshold });\n\t\t\tfor (const t of targets) io.observe(t);\n\t\t\treturn io;\n\t\t}\n\t\tlet mt = 0;\n\t\tlet io = null;\n\t\tlet st = null;\n\t\tonResize(() => {\n\t\t\tmt = -getScrollOffset();\n\t\t\tif (st) clearTimeout(st);\n\t\t\tst = setTimeout(() => {\n\t\t\t\tif (io) io.disconnect();\n\t\t\t\tio = init();\n\t\t\t}, 100);\n\t\t}, true);\n\t}\n\t\n\n\t/**\n\t * Scroll\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2023-01-16\n\t */\n\t\n\tfunction apply(cs, opts = {}) {\n\t\tif (cs.length === 0) return;\n\t\n\t\topts = Object.assign({\n\t\t\tstyleBar    : ':ncTabBar',\n\t\t\tstyleCurrent: ':ncCurrent',\n\t\t\tstyleActive : ':ncActive',\n\t\t\thashPrefix  : 'tsc:',\n\t\t}, opts);\n\t\tconst is = [];\n\t\tfor (let i = 0; i < cs.length; i += 1) {\n\t\t\tconst inst = create(cs[i], i + 1, opts);\n\t\t\tif (inst) is.push(inst);\n\t\t}\n\t\twindow.addEventListener('hashchange', () => is.forEach(onHashChanged));\n\t}\n\t\n\tfunction onHashChanged(inst) {\n\t\tconst tar = getCurrentByHash(inst, location.hash);\n\t\tinst.active = tar;\n\t\tsetTimeout(() => update(inst), 10);\n\t}\n\t\n\t\n\t// -------------------------------------------------------------------------\n\t\n\t\n\tfunction create(cont, cid, opts) {\n\t\tconst inst = {\n\t\t\topts,\n\t\t\tvs    : null,\n\t\t\tuls   : [],\n\t\t\tactive: null,\n\t\t}\n\t\tconst hs = extractHeadings(cont, cid, opts.hashPrefix);\n\t\tif (hs.length === 0) return false;\n\t\n\t\tconst noHash = location.hash.length <= 1;\n\t\tconst bars   = [];\n\t\ths.forEach((h, idx) => {\n\t\t\tconst bar = createBar(hs, h, opts, noHash && idx === 0);\n\t\t\tcont.insertBefore(bar.ul, h.elm);\n\t\t\tbars.push(bar);\n\t\t\tinst.uls.push(bar.ul);\n\t\t});\n\t\tassignEvent(inst, bars);\n\t\n\t\tinst.active = getCurrentByHash(inst, location.hash);\n\t\tsetTimeout(() => update(inst), 100);  // For avoiding unnecessary update\n\t\treturn inst;\n\t}\n\t\n\tfunction getCurrentByHash(inst, hash) {\n\t\tconst id = hash.replace('#', '');\n\t\tif (id !== '') {\n\t\t\tconst tar = document.getElementById(id);\n\t\t\tif (tar && inst.uls.indexOf(tar) !== 0) {\n\t\t\t\treturn tar;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\t\n\t\n\t// -------------------------------------------------------------------------\n\t\n\t\n\tfunction extractHeadings(cont, cid, prefix) {\n\t\tconst fh = getFirstHeading(cont);\n\t\tif (!fh) return [];\n\t\tconst tn = fh.tagName;\n\t\tconst hs = [];\n\t\n\t\tfor (const elm of [...cont.children]) {\n\t\t\tif (elm.tagName === tn) {\n\t\t\t\tconst id = `${prefix}${cid}-${hs.length + 1}`;\n\t\t\t\ths.push({ elm, id });\n\t\t\t}\n\t\t}\n\t\treturn hs;\n\t}\n\t\n\tfunction createBar(hs, curH, opts, activate) {\n\t\tconst ul = document.createElement('ul');\n\t\tul.id = curH.id;\n\t\tul.className = '';  // for Dummy\n\t\tsetClass(ul, opts.styleBar);\n\t\tif (activate) setClass(ul, opts.styleActive);\n\t\tconst as = [];\n\t\n\t\tfor (const h of hs) {\n\t\t\tconst a = createAnchor(h);\n\t\t\tconst li = document.createElement('li');\n\t\t\tif (h === curH) {\n\t\t\t\tsetClass(a, opts.styleCurrent);\n\t\t\t\tsetClass(li, opts.styleCurrent);\n\t\t\t}\n\t\t\tli.appendChild(a);\n\t\t\tul.appendChild(li);\n\t\t\tas.push(a);\n\t\t}\n\t\treturn { ul, as };\n\t}\n\t\n\t\n\t// -------------------------------------------------------------------------\n\t\n\t\n\tfunction assignEvent(inst, bars) {\n\t\tfor (const bar of bars) {\n\t\t\tbar.as.forEach((a, i) => {\n\t\t\t\ta.addEventListener('click', () => onClick(inst, bar.ul, bars[i].ul));\n\t\t\t});\n\t\t}\n\t\tonIntersect((vs) => {\n\t\t\tinst.vs = vs;\n\t\t\tupdate(inst);\n\t\t}, inst.uls, 0);\n\t}\n\t\n\tfunction onClick(inst, from, to) {\n\t\tif (to !== from) {\n\t\t\tconst fromY = from.getBoundingClientRect().top;\n\t\t\tconst toR   = to.getBoundingClientRect();\n\t\t\tif (toR.y < fromY && 0 <= toR.y && toR.y + toR.height < window.innerHeight) {\n\t\t\t\tsetTimeout(() => window.scrollBy({ top: toR.y - fromY, }), 200);\n\t\t\t}\n\t\t}\n\t\n\t\tinst.active = to;\n\t\tsetTimeout(() => {\n\t\t\tif (inst.active) {\n\t\t\t\tconst y = inst.active.getBoundingClientRect().top;\n\t\t\t\tinst.active = null;\n\t\t\t\tif (window.innerHeight < y) update(inst);\n\t\t\t}\n\t\t}, 1000);\n\t}\n\t\n\tfunction update(inst) {\n\t\tconst tar = inst.active ? inst.active : getFirstVisible(inst);\n\t\tfor (const ul of inst.uls) {\n\t\t\tsetClass(ul, inst.opts.styleActive, ul === tar);\n\t\t}\n\t}\n\t\n\tfunction getFirstVisible(inst) {\n\t\tif (!inst.vs) return null;\n\t\treturn inst.uls.find((ul, i) => inst.vs[i]);\n\t}\n\t\n\tNS.applyScroll = apply;\n\n\t/**\n\t * Common Functions\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2022-01-07\n\t */\n\t\n\tfunction getFirstHeading(container) {\n\t\tconst cs = container.children;\n\t\tfor (let i = 0; i < cs.length; i += 1) {\n\t\t\tif (/^H[1-6]$/.test(cs[i].tagName)) return cs[i];\n\t\t}\n\t\treturn null;\n\t}\n\t\n\tfunction createAnchor(h) {\n\t\tconst a = document.createElement('a');\n\t\ta.href  = '#' + h.id;\n\t\ta.title = h.elm.innerText;\n\t\tconst t = h.elm.title ? h.elm.title : h.elm.innerHTML;\n\t\n\t\ta.innerHTML = t;\n\t\ta.querySelectorAll('small').forEach(e => e.remove());\n\t\tif (a.innerText === '') {\n\t\t\ta.innerHTML = t;\n\t\t}\n\t\tspanning(a);\n\t\treturn a;\n\t}\n\t\n\tfunction spanning(e) {\n\t\tfor (const c of [...e.children]) {\n\t\t\tif (c.tagName === 'A' || c.tagName === 'SMALL') {\n\t\t\t\tconst s = document.createElement('span');\n\t\t\t\ts.innerHTML = c.innerHTML;\n\t\t\t\te.replaceChild(s, c);\n\t\t\t\tspanning(s);\n\t\t\t} else {\n\t\t\t\tspanning(c);\n\t\t\t}\n\t\t}\n\t}\n\t\n\n})(window['NACSS']['tab']);\n"]}