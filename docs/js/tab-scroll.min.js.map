{"version":3,"sources":["tab-scroll.js"],"names":["window","NS","create","cont","cid","opts","inst","vs","uls","active","hs","prefix","fh","container","cs","children","i","length","test","tagName","getFirstHeading","tn","elm","Array","from","id","push","extractHeaders","hashPrefix","bars","h","bar","createBar","insertBefore","ul","as","forEach","a","addEventListener","onClick","fn","doFirst","os","ts","init","r","rootMargin","mt","marginRight","marginBottom","marginLeft","io","IntersectionObserver","es","prevVs","indexOf","target","isIntersecting","vs0","vs1","isMatch","threshold","observe","fill","marginTop","st","resizeListeners","isRunning","args","requestAnimationFrame","throttle","onResize","clearTimeout","setTimeout","disconnect","observeIntersection","concat","onIntersect","update","targets","location","hash","replace","tar","document","getElementById","assignEvent","curH","createElement","className","enableClass","styleBar","createAnchor","li","styleCurrent","appendChild","clicked","y","getBoundingClientRect","top","innerHeight","find","getFirstVisible","styleActive","href","title","innerText","t","innerHTML","querySelectorAll","e","remove","spanning","c","s","replaceChild","enabled","cls","key","substr","startsWith","dataset","classList","add","tabScroll","Object","assign","l","passive"],"mappings":"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","file":"tab-scroll.min.js","sourcesContent":["/**\n *\n * Tab Style - Scroll (JS)\n *\n * @author Takuto Yanagida\n * @version 2021-10-19\n *\n */\n\n\nwindow['NACSS'] = window['NACSS'] || {};\n\n\n(function (NS) {\n\n\t/**\n\t *\n\t * Tab - Scroll (JS)\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-10-22\n\t *\n\t */\n\t\n\t\n\tfunction initialize(cs, opts = {}) {\n\t\tif (cs.length === 0) return;\n\t\n\t\topts = Object.assign({\n\t\t\tstyleBar    : ':ncTabBar',\n\t\t\tstyleCurrent: ':ncCurrent',\n\t\t\tstyleActive : ':ncActive',\n\t\t\thashPrefix  : 'tsc:',\n\t\t}, opts);\n\t\tfor (let i = 0; i < cs.length; i += 1) {\n\t\t\tcreate(cs[i], i + 1, opts);\n\t\t}\n\t}\n\t\n\tfunction create(cont, cid, opts) {\n\t\tconst inst = {\n\t\t\topts,\n\t\t\tvs    : null,\n\t\t\tuls   : [],\n\t\t\tactive: null,\n\t\t}\n\t\tconst hs = extractHeaders(cont, cid, opts.hashPrefix);\n\t\tif (hs.length === 0) return false;\n\t\n\t\tconst bars = [];\n\t\tfor (const h of hs) {\n\t\t\tconst bar = createBar(hs, h, opts);\n\t\t\tcont.insertBefore(bar.ul, h.elm);\n\t\t\tbars.push(bar);\n\t\t\tinst.uls.push(bar.ul);\n\t\t}\n\t\tassignEvent(inst, bars);\n\t}\n\t\n\t\n\t// -------------------------------------------------------------------------\n\t\n\t\n\tfunction extractHeaders(cont, cid, prefix) {\n\t\tconst fh = getFirstHeading(cont);\n\t\tif (!fh) return [];\n\t\tconst tn = fh.tagName;\n\t\tconst hs = [];\n\t\n\t\tfor (const elm of Array.from(cont.children)) {\n\t\t\tif (elm.tagName === tn) {\n\t\t\t\tconst id = `${prefix}${cid}-${hs.length + 1}`;\n\t\t\t\ths.push({ elm, id });\n\t\t\t}\n\t\t}\n\t\treturn hs;\n\t}\n\t\n\tfunction createBar(hs, curH, opts) {\n\t\tconst ul = document.createElement('ul');\n\t\tul.id = curH.id;\n\t\tul.className = '';  // for Dummy\n\t\tenableClass(true, ul, opts.styleBar);\n\t\tconst as = [];\n\t\n\t\tfor (const h of hs) {\n\t\t\tconst a = createAnchor(h);\n\t\t\tconst li = document.createElement('li');\n\t\t\tif (h === curH) enableClass(true, li, opts.styleCurrent);\n\t\t\tli.appendChild(a);\n\t\t\tul.appendChild(li);\n\t\t\tas.push(a);\n\t\t}\n\t\treturn { ul, as };\n\t}\n\t\n\t\n\t// -------------------------------------------------------------------------\n\t\n\t\n\tfunction assignEvent(inst, bars) {\n\t\tfor (const bar of bars) {\n\t\t\tbar.as.forEach((a, i) => {\n\t\t\t\ta.addEventListener('click', () => onClick(inst, bars[i].ul));\n\t\t\t});\n\t\t}\n\t\tonIntersect((vs) => {\n\t\t\tinst.vs = vs;\n\t\t\tupdate(inst);\n\t\t}, true, { targets: inst.uls, marginTop: 'OFFSET', threshold: 0 });\n\t\n\t\tconst h = location.hash;\n\t\tif (h.indexOf('#') !== -1) {\n\t\t\tconst id = h.replace('#', '');\n\t\t\tif (!id) return;\n\t\t\tconst tar = document.getElementById(id);\n\t\t\tif (inst.uls.indexOf(tar) !== 0) {\n\t\t\t\tinst.active = tar;\n\t\t\t}\n\t\t}\n\t\tsetTimeout(() => update(inst), 10);\n\t}\n\t\n\tfunction onClick(inst, clicked) {\n\t\tinst.active = clicked;\n\t\tsetTimeout(() => update(inst), 10);\n\t\tsetTimeout(() => {\n\t\t\tif (inst.active) {\n\t\t\t\tconst y = inst.active.getBoundingClientRect().top;\n\t\t\t\tinst.active = null;\n\t\t\t\tif (window.innerHeight < y) update(inst);\n\t\t\t}\n\t\t}, 1000);\n\t}\n\t\n\tfunction update(inst) {\n\t\tconst tar = inst.active ? inst.active : getFirstVisible(inst);\n\t\tfor (const ul of inst.uls) {\n\t\t\tenableClass(ul === tar, ul, inst.opts.styleActive);\n\t\t}\n\t}\n\t\n\tfunction getFirstVisible(inst) {\n\t\tif (!inst.vs) return null;\n\t\treturn inst.uls.find((ul, i) => inst.vs[i]);\n\t}\n\t\n\tNS.tabScroll = initialize;\n\n\t/**\n\t *\n\t * Common Functions\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-10-23\n\t *\n\t */\n\t\n\t\n\tfunction getFirstHeading(container) {\n\t\tconst cs = container.children;\n\t\tfor (let i = 0; i < cs.length; i += 1) {\n\t\t\tif (/^H[1-6]$/.test(cs[i].tagName)) return cs[i];\n\t\t}\n\t\treturn null;\n\t}\n\t\n\tfunction createAnchor(h) {\n\t\tconst a = document.createElement('a');\n\t\ta.href  = '#' + h.id;\n\t\ta.title = h.elm.innerText;\n\t\tconst t = h.elm.title ? h.elm.title : h.elm.innerHTML;\n\t\n\t\ta.innerHTML = t;\n\t\ta.querySelectorAll('small').forEach(e => e.remove());\n\t\tif (a.innerText === '') {\n\t\t\ta.innerHTML = t;\n\t\t}\n\t\tspanning(a);\n\t\treturn a;\n\t}\n\t\n\tfunction spanning(e) {\n\t\tfor (const c of Array.from(e.children)) {\n\t\t\tif (c.tagName === 'A' || c.tagName === 'SMALL') {\n\t\t\t\tconst s = document.createElement('span');\n\t\t\t\ts.innerHTML = c.innerHTML;\n\t\t\t\te.replaceChild(s, c);\n\t\t\t\tspanning(s);\n\t\t\t} else {\n\t\t\t\tspanning(c);\n\t\t\t}\n\t\t}\n\t}\n\t\n\t/**\n\t *\n\t * Utilities\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-10-21\n\t *\n\t */\n\t\n\t\n\tfunction enableClass(enabled, tar, cls) {\n\t\tconst key = cls.substr(1);\n\t\tif (cls.startsWith(':')) {\n\t\t\tif (enabled) {\n\t\t\t\ttar.dataset[key] = '';\n\t\t\t} else {\n\t\t\t\tdelete tar.dataset[key];\n\t\t\t}\n\t\t} else {\n\t\t\tif (enabled) {\n\t\t\t\ttar.classList.add(key);\n\t\t\t} else {\n\t\t\t\ttar.classList.remove(key);\n\t\t\t}\n\t\n\t\t}\n\t}\n\t\n\tfunction throttle(fn) {\n\t\tlet isRunning;\n\t\treturn (...args) => {\n\t\t\tif (isRunning) return;\n\t\t\tisRunning = true;\n\t\t\trequestAnimationFrame(() => {\n\t\t\t\tisRunning = false;\n\t\t\t\tfn(...args);\n\t\t\t});\n\t\t};\n\t}\n\t\n\tconst resizeListeners = [];\n\t\n\tfunction onResize(fn, doFirst = false) {\n\t\tif (doFirst) fn();\n\t\tresizeListeners.push(throttle(fn));\n\t}\n\t\n\tdocument.addEventListener('DOMContentLoaded', () => {\n\t\twindow.addEventListener('resize', () => {\n\t\t\tfor (const l of resizeListeners) l();\n\t\t}, { passive: true });\n\t});\n\t\n\tfunction onIntersect(fn, doFirst = false, opts = {}) {\n\t\t// if (doFirst) fn();\n\t\topts['targets']      = opts['targets']      ?? [];\n\t\topts['marginTop']    = opts['marginTop']    ?? 0;\n\t\topts['marginLeft']   = opts['marginLeft']   ?? 0;\n\t\topts['marginRight']  = opts['marginRight']  ?? 0;\n\t\topts['marginBottom'] = opts['marginBottom'] ?? 0;\n\t\topts['threshold']    = opts['threshold']    ?? 1;\n\t\n\t\tobserveIntersection(fn, opts, opts['targets'].concat());\n\t}\n\t\n\tfunction observeIntersection(fn, os, ts) {\n\t\tfunction init() {\n\t\t\t// for workaround of rootMargin bug on Android Chrome\n\t\t\tconst r = 1;//(document.body.classList.contains('android') && NS.BROWSER === 'chrome') ? window.devicePixelRatio : 1;\n\t\t\tconst rootMargin = (mt * r) + 'px ' + (os.marginRight * r) + 'px ' + (os.marginBottom * r) + 'px ' + (os.marginLeft * r) + 'px';\n\t\t\tconst io = new IntersectionObserver((es) => {\n\t\t\t\tconst vs = Array.from(prevVs);\n\t\t\t\tfor (let i = 0; i < es.length; i += 1) vs[ts.indexOf(es[i].target)] = es[i].isIntersecting;\n\t\t\t\tif (!isMatch(vs, prevVs)) fn(vs);\n\t\t\t\tprevVs = vs;\n\t\t\t}, { rootMargin: rootMargin, threshold: os.threshold });\n\t\t\tfor (let i = 0; i < ts.length; i += 1) io.observe(ts[i]);\n\t\t\treturn io;\n\t\t}\n\t\tlet prevVs = Array(ts.length).fill(false);\n\t\tlet mt = os.marginTop;\n\t\tif (mt !== 'OFFSET') {\n\t\t\tinit();\n\t\t\treturn;\n\t\t}\n\t\tlet io = null;\n\t\tlet st = null;\n\t\t// const off = NS.makeOffsetFunction(true, true);  // Initialize here\n\t\tonResize(() => {\n\t\t\tmt = 0;//-off();\n\t\t\tif (st) clearTimeout(st);\n\t\t\tst = setTimeout(() => {\n\t\t\t\tif (io) io.disconnect();\n\t\t\t\tio = init();\n\t\t\t}, 100);\n\t\t}, true);\n\t}\n\t\n\tfunction isMatch(vs0, vs1) {\n\t\tif (vs1.length !== vs0.length) return false;\n\t\tfor (let i = 0; i < vs0.length; i += 1) {\n\t\t\tif (vs0[i] !== vs1[i]) return false;\n\t\t}\n\t\treturn true;\n\t}\n\n})(window['NACSS']);\n"]}