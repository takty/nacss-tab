{"version":3,"sources":["tab-scroll.js"],"names":["window","NS","setClass","tar","cls","enabled","val","key","substr","startsWith","dataset","c","join","classList","add","remove","resizeListeners","onResize","fn","doFirst","push","isRunning","args","requestAnimationFrame","throttle","onIntersect","targets","threshold","rootMargin","vs","Array","length","fill","tm","Map","forEach","t","i","set","mt","io","st","s","getComputedStyle","document","documentElement","parseInt","scrollPaddingTop","Number","isNaN","getScrollOffset","clearTimeout","setTimeout","disconnect","IntersectionObserver","es","e","get","target","isIntersecting","replace","observe","init","onHashChanged","inst","getCurrentByHash","location","hash","active","update","create","cont","cid","opts","uls","hs","prefix","fh","container","cs","children","test","tagName","getFirstHeading","tn","elm","from","id","extractHeaders","hashPrefix","noHash","bars","h","idx","bar","curH","activate","ul","createElement","className","styleBar","styleActive","as","a","createAnchor","li","styleCurrent","appendChild","createBar","insertBefore","addEventListener","onClick","assignEvent","getElementById","indexOf","clicked","y","getBoundingClientRect","top","innerHeight","find","getFirstVisible","href","title","innerText","innerHTML","querySelectorAll","spanning","replaceChild","l","passive","applyScroll","Object","assign","is"],"mappings":"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","file":"tab-scroll.min.js","sourcesContent":["/**\n *\n * Tab Scroll\n *\n * @author Takuto Yanagida\n * @version 2021-12-26\n *\n */\n\n\n'use strict';\n\nwindow['NACSS']        = window['NACSS']        || {};\nwindow['NACSS']['tab'] = window['NACSS']['tab'] || {};\n\n\n((NS) => {\n\n\t/**\n\t *\n\t * Style Class Utilities\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-11-11\n\t *\n\t */\n\t\n\t\n\tfunction hasClass(tar, cls) {\n\t\tconst key = cls.substr(1);\n\t\tif (cls.startsWith(':')) {\n\t\t\treturn tar.dataset[key] !== undefined;\n\t\t} else {\n\t\t\treturn tar.classList.contains(key);\n\t\t}\n\t}\n\t\n\tfunction setClass(tar, cls, enabled = true, val = '') {\n\t\tconst key = cls.substr(1);\n\t\tif (cls.startsWith(':')) {\n\t\t\tif (enabled) {\n\t\t\t\ttar.dataset[key] = val;\n\t\t\t} else {\n\t\t\t\tdelete tar.dataset[key];\n\t\t\t}\n\t\t} else {\n\t\t\tconst c = [key, val].join('-');\n\t\t\tif (enabled) {\n\t\t\t\ttar.classList.add(c);\n\t\t\t} else {\n\t\t\t\ttar.classList.remove(c);\n\t\t\t}\n\t\t}\n\t}\n\t\n\tfunction getSelector(cls) {\n\t\tif (cls.startsWith(':')) {\n\t\t\treturn `*[data-${cls.substr(1).replace(/([A-Z])/g, c => '-' + c.charAt(0).toLowerCase())}]`;\n\t\t} else {\n\t\t\treturn `*${cls}`;\n\t\t}\n\t}\n\t\n\t/**\n\t *\n\t * Utilities\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-12-06\n\t *\n\t */\n\t\n\t\n\tfunction getScrollOffset() {\n\t\tconst s   = getComputedStyle(document.documentElement);\n\t\tconst val = parseInt(s.scrollPaddingTop);\n\t\treturn Number.isNaN(val) ? 0 : val;\n\t}\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tfunction throttle(fn) {\n\t\tlet isRunning;\n\t\treturn (...args) => {\n\t\t\tif (isRunning) return;\n\t\t\tisRunning = true;\n\t\t\trequestAnimationFrame(() => {\n\t\t\t\tisRunning = false;\n\t\t\t\tfn(...args);\n\t\t\t});\n\t\t};\n\t}\n\t\n\tconst resizeListeners = [];\n\t\n\tfunction onResize(fn, doFirst = false) {\n\t\tif (doFirst) fn();\n\t\tresizeListeners.push(throttle(fn));\n\t}\n\t\n\tdocument.addEventListener('DOMContentLoaded', () => {\n\t\twindow.addEventListener('resize', () => {\n\t\t\tfor (const l of resizeListeners) l();\n\t\t}, { passive: true });\n\t});\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tfunction onIntersect(fn, targets, threshold = 0, rootMargin = '* 0px 0px 0px') {\n\t\tconst vs = Array(targets.length).fill(false);\n\t\tconst tm = new Map();\n\t\ttargets.forEach((t, i) => tm.set(t, i));\n\t\n\t\tfunction init() {\n\t\t\tconst io = new IntersectionObserver((es) => {\n\t\t\t\tfor (const e of es) vs[tm.get(e.target)] = e.isIntersecting;\n\t\t\t\tfn(vs);\n\t\t\t}, { rootMargin: rootMargin.replace('*', `${mt}px`), threshold });\n\t\t\tfor (const t of targets) io.observe(t);\n\t\t\treturn io;\n\t\t}\n\t\tlet mt = 0;\n\t\tlet io = null;\n\t\tlet st = null;\n\t\tonResize(() => {\n\t\t\tmt = -getScrollOffset();\n\t\t\tif (st) clearTimeout(st);\n\t\t\tst = setTimeout(() => {\n\t\t\t\tif (io) io.disconnect();\n\t\t\t\tio = init();\n\t\t\t}, 100);\n\t\t}, true);\n\t}\n\t\n\n\t/**\n\t *\n\t * Scroll\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-12-26\n\t *\n\t */\n\t\n\t\n\tfunction apply(cs, opts = {}) {\n\t\tif (cs.length === 0) return;\n\t\n\t\topts = Object.assign({\n\t\t\tstyleBar    : ':ncTabBar',\n\t\t\tstyleCurrent: ':ncCurrent',\n\t\t\tstyleActive : ':ncActive',\n\t\t\thashPrefix  : 'tsc:',\n\t\t}, opts);\n\t\tconst is = [];\n\t\tfor (let i = 0; i < cs.length; i += 1) {\n\t\t\tconst inst = create(cs[i], i + 1, opts);\n\t\t\tif (inst) is.push(inst);\n\t\t}\n\t\twindow.addEventListener('hashchange', () => is.forEach(onHashChanged));\n\t}\n\t\n\tfunction onHashChanged(inst) {\n\t\tconst tar = getCurrentByHash(inst, location.hash);\n\t\tinst.active = tar;\n\t\tsetTimeout(() => update(inst), 10);\n\t}\n\t\n\t\n\t// -------------------------------------------------------------------------\n\t\n\t\n\tfunction create(cont, cid, opts) {\n\t\tconst inst = {\n\t\t\topts,\n\t\t\tvs    : null,\n\t\t\tuls   : [],\n\t\t\tactive: null,\n\t\t}\n\t\tconst hs = extractHeaders(cont, cid, opts.hashPrefix);\n\t\tif (hs.length === 0) return false;\n\t\n\t\tconst noHash = location.hash.length <= 1;\n\t\tconst bars   = [];\n\t\ths.forEach((h, idx) => {\n\t\t\tconst bar = createBar(hs, h, opts, noHash && idx === 0);\n\t\t\tcont.insertBefore(bar.ul, h.elm);\n\t\t\tbars.push(bar);\n\t\t\tinst.uls.push(bar.ul);\n\t\t});\n\t\tassignEvent(inst, bars);\n\t\n\t\tinst.active = getCurrentByHash(inst, location.hash);\n\t\tsetTimeout(() => update(inst), 100);  // For avoiding unnecessary update\n\t\treturn inst;\n\t}\n\t\n\tfunction getCurrentByHash(inst, hash) {\n\t\tconst id = hash.replace('#', '');\n\t\tif (id !== '') {\n\t\t\tconst tar = document.getElementById(id);\n\t\t\tif (tar && inst.uls.indexOf(tar) !== 0) {\n\t\t\t\treturn tar;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\t\n\t\n\t// -------------------------------------------------------------------------\n\t\n\t\n\tfunction extractHeaders(cont, cid, prefix) {\n\t\tconst fh = getFirstHeading(cont);\n\t\tif (!fh) return [];\n\t\tconst tn = fh.tagName;\n\t\tconst hs = [];\n\t\n\t\tfor (const elm of Array.from(cont.children)) {\n\t\t\tif (elm.tagName === tn) {\n\t\t\t\tconst id = `${prefix}${cid}-${hs.length + 1}`;\n\t\t\t\ths.push({ elm, id });\n\t\t\t}\n\t\t}\n\t\treturn hs;\n\t}\n\t\n\tfunction createBar(hs, curH, opts, activate) {\n\t\tconst ul = document.createElement('ul');\n\t\tul.id = curH.id;\n\t\tul.className = '';  // for Dummy\n\t\tsetClass(ul, opts.styleBar);\n\t\tif (activate) setClass(ul, opts.styleActive);\n\t\tconst as = [];\n\t\n\t\tfor (const h of hs) {\n\t\t\tconst a = createAnchor(h);\n\t\t\tconst li = document.createElement('li');\n\t\t\tif (h === curH) setClass(li, opts.styleCurrent);\n\t\t\tli.appendChild(a);\n\t\t\tul.appendChild(li);\n\t\t\tas.push(a);\n\t\t}\n\t\treturn { ul, as };\n\t}\n\t\n\t\n\t// -------------------------------------------------------------------------\n\t\n\t\n\tfunction assignEvent(inst, bars) {\n\t\tfor (const bar of bars) {\n\t\t\tbar.as.forEach((a, i) => {\n\t\t\t\ta.addEventListener('click', () => onClick(inst, bars[i].ul));\n\t\t\t});\n\t\t}\n\t\tonIntersect((vs) => {\n\t\t\tinst.vs = vs;\n\t\t\tupdate(inst);\n\t\t}, inst.uls, 0);\n\t}\n\t\n\tfunction onClick(inst, clicked) {\n\t\tinst.active = clicked;\n\t\tsetTimeout(() => {\n\t\t\tif (inst.active) {\n\t\t\t\tconst y = inst.active.getBoundingClientRect().top;\n\t\t\t\tinst.active = null;\n\t\t\t\tif (window.innerHeight < y) update(inst);\n\t\t\t}\n\t\t}, 1000);\n\t}\n\t\n\tfunction update(inst) {\n\t\tconst tar = inst.active ? inst.active : getFirstVisible(inst);\n\t\tfor (const ul of inst.uls) {\n\t\t\tsetClass(ul, inst.opts.styleActive, ul === tar);\n\t\t}\n\t}\n\t\n\tfunction getFirstVisible(inst) {\n\t\tif (!inst.vs) return null;\n\t\treturn inst.uls.find((ul, i) => inst.vs[i]);\n\t}\n\t\n\tNS.applyScroll = apply;\n\n\t/**\n\t *\n\t * Common Functions\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-10-23\n\t *\n\t */\n\t\n\t\n\tfunction getFirstHeading(container) {\n\t\tconst cs = container.children;\n\t\tfor (let i = 0; i < cs.length; i += 1) {\n\t\t\tif (/^H[1-6]$/.test(cs[i].tagName)) return cs[i];\n\t\t}\n\t\treturn null;\n\t}\n\t\n\tfunction createAnchor(h) {\n\t\tconst a = document.createElement('a');\n\t\ta.href  = '#' + h.id;\n\t\ta.title = h.elm.innerText;\n\t\tconst t = h.elm.title ? h.elm.title : h.elm.innerHTML;\n\t\n\t\ta.innerHTML = t;\n\t\ta.querySelectorAll('small').forEach(e => e.remove());\n\t\tif (a.innerText === '') {\n\t\t\ta.innerHTML = t;\n\t\t}\n\t\tspanning(a);\n\t\treturn a;\n\t}\n\t\n\tfunction spanning(e) {\n\t\tfor (const c of Array.from(e.children)) {\n\t\t\tif (c.tagName === 'A' || c.tagName === 'SMALL') {\n\t\t\t\tconst s = document.createElement('span');\n\t\t\t\ts.innerHTML = c.innerHTML;\n\t\t\t\te.replaceChild(s, c);\n\t\t\t\tspanning(s);\n\t\t\t} else {\n\t\t\t\tspanning(c);\n\t\t\t}\n\t\t}\n\t}\n\t\n\n})(window['NACSS']['tab']);\n"]}