{"version":3,"sources":["tab-scroll.js"],"names":["window","NS","onHashChanged","inst","tar","getCurrentByHash","location","hash","active","setTimeout","update","create","cont","cid","opts","vs","uls","hs","prefix","fh","container","cs","children","i","length","test","tagName","getFirstHeading","tn","elm","Array","from","id","push","extractHeaders","hashPrefix","bars","h","bar","createBar","insertBefore","ul","as","forEach","a","addEventListener","onClick","fn","targets","threshold","fill","tm","Map","init","io","IntersectionObserver","es","e","get","target","isIntersecting","rootMargin","mt","t","observe","set","st","doFirst","resizeListeners","isRunning","args","requestAnimationFrame","throttle","onResize","s","getComputedStyle","document","getElementsByTagName","parseInt","scrollPaddingTop","clearTimeout","disconnect","onIntersect","assignEvent","replace","getElementById","indexOf","curH","createElement","className","enableClass","styleBar","createAnchor","li","styleCurrent","appendChild","clicked","y","getBoundingClientRect","top","innerHeight","find","getFirstVisible","styleActive","href","title","innerText","innerHTML","querySelectorAll","remove","spanning","c","replaceChild","enabled","cls","key","substr","startsWith","dataset","classList","add","tabScroll","Object","assign","is","l","passive"],"mappings":"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","file":"tab-scroll.min.js","sourcesContent":["/**\n *\n * Tab Style - Scroll (JS)\n *\n * @author Takuto Yanagida\n * @version 2021-10-19\n *\n */\n\n\nwindow['NACSS'] = window['NACSS'] || {};\n\n\n(function (NS) {\n\n\t/**\n\t *\n\t * Tab - Scroll (JS)\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-10-23\n\t *\n\t */\n\t\n\t\n\tfunction initialize(cs, opts = {}) {\n\t\tif (cs.length === 0) return;\n\t\n\t\topts = Object.assign({\n\t\t\tstyleBar    : ':ncTabBar',\n\t\t\tstyleCurrent: ':ncCurrent',\n\t\t\tstyleActive : ':ncActive',\n\t\t\thashPrefix  : 'tsc:',\n\t\t}, opts);\n\t\tconst is = [];\n\t\tfor (let i = 0; i < cs.length; i += 1) {\n\t\t\tconst inst = create(cs[i], i + 1, opts);\n\t\t\tif (inst) is.push(inst);\n\t\t}\n\t\twindow.addEventListener('hashchange', () => is.forEach(onHashChanged));\n\t}\n\t\n\tfunction onHashChanged(inst) {\n\t\tconst tar = getCurrentByHash(inst, location.hash);\n\t\tinst.active = tar;\n\t\tsetTimeout(() => update(inst), 10);\n\t}\n\t\n\t\n\t// -------------------------------------------------------------------------\n\t\n\t\n\tfunction create(cont, cid, opts) {\n\t\tconst inst = {\n\t\t\topts,\n\t\t\tvs    : null,\n\t\t\tuls   : [],\n\t\t\tactive: null,\n\t\t}\n\t\tconst hs = extractHeaders(cont, cid, opts.hashPrefix);\n\t\tif (hs.length === 0) return false;\n\t\n\t\tconst bars = [];\n\t\tfor (const h of hs) {\n\t\t\tconst bar = createBar(hs, h, opts);\n\t\t\tcont.insertBefore(bar.ul, h.elm);\n\t\t\tbars.push(bar);\n\t\t\tinst.uls.push(bar.ul);\n\t\t}\n\t\tassignEvent(inst, bars);\n\t\n\t\tinst.active = getCurrentByHash(inst, location.hash);\n\t\tsetTimeout(() => update(inst), 10);\n\t\treturn inst;\n\t}\n\t\n\tfunction getCurrentByHash(inst, hash) {\n\t\tconst id = hash.replace('#', '');\n\t\tif (id !== '') {\n\t\t\tconst tar = document.getElementById(id);\n\t\t\tif (tar && inst.uls.indexOf(tar) !== 0) {\n\t\t\t\treturn tar;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\t\n\t\n\t// -------------------------------------------------------------------------\n\t\n\t\n\tfunction extractHeaders(cont, cid, prefix) {\n\t\tconst fh = getFirstHeading(cont);\n\t\tif (!fh) return [];\n\t\tconst tn = fh.tagName;\n\t\tconst hs = [];\n\t\n\t\tfor (const elm of Array.from(cont.children)) {\n\t\t\tif (elm.tagName === tn) {\n\t\t\t\tconst id = `${prefix}${cid}-${hs.length + 1}`;\n\t\t\t\ths.push({ elm, id });\n\t\t\t}\n\t\t}\n\t\treturn hs;\n\t}\n\t\n\tfunction createBar(hs, curH, opts) {\n\t\tconst ul = document.createElement('ul');\n\t\tul.id = curH.id;\n\t\tul.className = '';  // for Dummy\n\t\tenableClass(true, ul, opts.styleBar);\n\t\tconst as = [];\n\t\n\t\tfor (const h of hs) {\n\t\t\tconst a = createAnchor(h);\n\t\t\tconst li = document.createElement('li');\n\t\t\tif (h === curH) enableClass(true, li, opts.styleCurrent);\n\t\t\tli.appendChild(a);\n\t\t\tul.appendChild(li);\n\t\t\tas.push(a);\n\t\t}\n\t\treturn { ul, as };\n\t}\n\t\n\t\n\t// -------------------------------------------------------------------------\n\t\n\t\n\tfunction assignEvent(inst, bars) {\n\t\tfor (const bar of bars) {\n\t\t\tbar.as.forEach((a, i) => {\n\t\t\t\ta.addEventListener('click', () => onClick(inst, bars[i].ul));\n\t\t\t});\n\t\t}\n\t\tonIntersect((vs) => {\n\t\t\tinst.vs = vs;\n\t\t\tupdate(inst);\n\t\t}, inst.uls, 0);\n\t}\n\t\n\tfunction onClick(inst, clicked) {\n\t\tinst.active = clicked;\n\t\tsetTimeout(() => {\n\t\t\tif (inst.active) {\n\t\t\t\tconst y = inst.active.getBoundingClientRect().top;\n\t\t\t\tinst.active = null;\n\t\t\t\tif (window.innerHeight < y) update(inst);\n\t\t\t}\n\t\t}, 1000);\n\t}\n\t\n\tfunction update(inst) {\n\t\tconst tar = inst.active ? inst.active : getFirstVisible(inst);\n\t\tfor (const ul of inst.uls) {\n\t\t\tenableClass(ul === tar, ul, inst.opts.styleActive);\n\t\t}\n\t}\n\t\n\tfunction getFirstVisible(inst) {\n\t\tif (!inst.vs) return null;\n\t\treturn inst.uls.find((ul, i) => inst.vs[i]);\n\t}\n\t\n\tNS.tabScroll = initialize;\n\n\t/**\n\t *\n\t * Common Functions\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-10-23\n\t *\n\t */\n\t\n\t\n\tfunction getFirstHeading(container) {\n\t\tconst cs = container.children;\n\t\tfor (let i = 0; i < cs.length; i += 1) {\n\t\t\tif (/^H[1-6]$/.test(cs[i].tagName)) return cs[i];\n\t\t}\n\t\treturn null;\n\t}\n\t\n\tfunction createAnchor(h) {\n\t\tconst a = document.createElement('a');\n\t\ta.href  = '#' + h.id;\n\t\ta.title = h.elm.innerText;\n\t\tconst t = h.elm.title ? h.elm.title : h.elm.innerHTML;\n\t\n\t\ta.innerHTML = t;\n\t\ta.querySelectorAll('small').forEach(e => e.remove());\n\t\tif (a.innerText === '') {\n\t\t\ta.innerHTML = t;\n\t\t}\n\t\tspanning(a);\n\t\treturn a;\n\t}\n\t\n\tfunction spanning(e) {\n\t\tfor (const c of Array.from(e.children)) {\n\t\t\tif (c.tagName === 'A' || c.tagName === 'SMALL') {\n\t\t\t\tconst s = document.createElement('span');\n\t\t\t\ts.innerHTML = c.innerHTML;\n\t\t\t\te.replaceChild(s, c);\n\t\t\t\tspanning(s);\n\t\t\t} else {\n\t\t\t\tspanning(c);\n\t\t\t}\n\t\t}\n\t}\n\t\n\t/**\n\t *\n\t * Utilities\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-10-23\n\t *\n\t */\n\t\n\t\n\tfunction enableClass(enabled, tar, cls) {\n\t\tconst key = cls.substr(1);\n\t\tif (cls.startsWith(':')) {\n\t\t\tif (enabled) {\n\t\t\t\ttar.dataset[key] = '';\n\t\t\t} else {\n\t\t\t\tdelete tar.dataset[key];\n\t\t\t}\n\t\t} else {\n\t\t\tif (enabled) {\n\t\t\t\ttar.classList.add(key);\n\t\t\t} else {\n\t\t\t\ttar.classList.remove(key);\n\t\t\t}\n\t\n\t\t}\n\t}\n\t\n\tfunction throttle(fn) {\n\t\tlet isRunning;\n\t\treturn (...args) => {\n\t\t\tif (isRunning) return;\n\t\t\tisRunning = true;\n\t\t\trequestAnimationFrame(() => {\n\t\t\t\tisRunning = false;\n\t\t\t\tfn(...args);\n\t\t\t});\n\t\t};\n\t}\n\t\n\tconst resizeListeners = [];\n\t\n\tfunction onResize(fn, doFirst = false) {\n\t\tif (doFirst) fn();\n\t\tresizeListeners.push(throttle(fn));\n\t}\n\t\n\tdocument.addEventListener('DOMContentLoaded', () => {\n\t\twindow.addEventListener('resize', () => {\n\t\t\tfor (const l of resizeListeners) l();\n\t\t}, { passive: true });\n\t});\n\t\n\tfunction onIntersect(fn, targets, threshold) {\n\t\tconst vs = Array(targets.length).fill(false);\n\t\tconst tm = new Map();\n\t\ttargets.forEach((t, i) => tm.set(t, i));\n\t\n\t\tfunction init() {\n\t\t\tconst io = new IntersectionObserver((es) => {\n\t\t\t\tfor (const e of es) vs[tm.get(e.target)] = e.isIntersecting;\n\t\t\t\tfn(vs);\n\t\t\t}, { rootMargin: `${mt}px 0px 0px 0px`, threshold });\n\t\t\tfor (const t of targets) io.observe(t);\n\t\t\treturn io;\n\t\t}\n\t\tlet mt = 0;\n\t\tlet io = null;\n\t\tlet st = null;\n\t\tonResize(() => {\n\t\t\tconst s = getComputedStyle(document.getElementsByTagName('html')[0]);\n\t\t\tmt = -parseInt(s.scrollPaddingTop);\n\t\t\tif (st) clearTimeout(st);\n\t\t\tst = setTimeout(() => {\n\t\t\t\tif (io) io.disconnect();\n\t\t\t\tio = init();\n\t\t\t}, 100);\n\t\t}, true);\n\t}\n\t\n\n})(window['NACSS']);\n"]}