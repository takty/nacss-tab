{"version":3,"sources":["tab-scroll.js"],"names":["window","NS","onHashChanged","inst","tar","getCurrentByHash","location","hash","active","setTimeout","update","create","cont","cid","opts","vs","uls","hs","prefix","fh","container","cs","children","i","length","test","tagName","getFirstHeading","tn","elm","Array","from","id","push","extractHeaders","hashPrefix","noHash","bars","forEach","h","idx","bar","curH","activate","ul","document","createElement","className","setClass","styleBar","styleActive","as","a","createAnchor","li","styleCurrent","appendChild","createBar","insertBefore","addEventListener","onClick","fn","targets","threshold","rootMargin","fill","tm","Map","init","io","IntersectionObserver","es","e","get","target","isIntersecting","replace","mt","t","observe","set","st","doFirst","resizeListeners","isRunning","args","requestAnimationFrame","throttle","onResize","s","getComputedStyle","documentElement","parseInt","scrollPaddingTop","getScrollOffset","clearTimeout","disconnect","onIntersect","assignEvent","getElementById","indexOf","clicked","y","getBoundingClientRect","top","innerHeight","find","getFirstVisible","cls","enabled","val","key","substr","startsWith","dataset","c","join","classList","add","remove","tabScroll","Object","assign","is","href","title","innerText","innerHTML","querySelectorAll","spanning","replaceChild","l","passive"],"mappings":"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","file":"tab-scroll.min.js","sourcesContent":["/**\n *\n * Tab Scroll\n *\n * @author Takuto Yanagida\n * @version 2021-11-11\n *\n */\n\n\nwindow['NACSS'] = window['NACSS'] || {};\n\n\n(function (NS) {\n\n\t/**\n\t *\n\t * Scroll\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-11-30\n\t *\n\t */\n\t\n\t\n\tfunction initialize(cs, opts = {}) {\n\t\tif (cs.length === 0) return;\n\t\n\t\topts = Object.assign({\n\t\t\tstyleBar    : ':ncTabBar',\n\t\t\tstyleCurrent: ':ncCurrent',\n\t\t\tstyleActive : ':ncActive',\n\t\t\thashPrefix  : 'tsc:',\n\t\t}, opts);\n\t\tconst is = [];\n\t\tfor (let i = 0; i < cs.length; i += 1) {\n\t\t\tconst inst = create(cs[i], i + 1, opts);\n\t\t\tif (inst) is.push(inst);\n\t\t}\n\t\twindow.addEventListener('hashchange', () => is.forEach(onHashChanged));\n\t}\n\t\n\tfunction onHashChanged(inst) {\n\t\tconst tar = getCurrentByHash(inst, location.hash);\n\t\tinst.active = tar;\n\t\tsetTimeout(() => update(inst), 10);\n\t}\n\t\n\t\n\t// -------------------------------------------------------------------------\n\t\n\t\n\tfunction create(cont, cid, opts) {\n\t\tconst inst = {\n\t\t\topts,\n\t\t\tvs    : null,\n\t\t\tuls   : [],\n\t\t\tactive: null,\n\t\t}\n\t\tconst hs = extractHeaders(cont, cid, opts.hashPrefix);\n\t\tif (hs.length === 0) return false;\n\t\n\t\tconst noHash = location.hash.length <= 1;\n\t\tconst bars   = [];\n\t\ths.forEach((h, idx) => {\n\t\t\tconst bar = createBar(hs, h, opts, noHash && idx === 0);\n\t\t\tcont.insertBefore(bar.ul, h.elm);\n\t\t\tbars.push(bar);\n\t\t\tinst.uls.push(bar.ul);\n\t\t});\n\t\tassignEvent(inst, bars);\n\t\n\t\tinst.active = getCurrentByHash(inst, location.hash);\n\t\tsetTimeout(() => update(inst), 100);  // For avoiding unnecessary update\n\t\treturn inst;\n\t}\n\t\n\tfunction getCurrentByHash(inst, hash) {\n\t\tconst id = hash.replace('#', '');\n\t\tif (id !== '') {\n\t\t\tconst tar = document.getElementById(id);\n\t\t\tif (tar && inst.uls.indexOf(tar) !== 0) {\n\t\t\t\treturn tar;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\t\n\t\n\t// -------------------------------------------------------------------------\n\t\n\t\n\tfunction extractHeaders(cont, cid, prefix) {\n\t\tconst fh = getFirstHeading(cont);\n\t\tif (!fh) return [];\n\t\tconst tn = fh.tagName;\n\t\tconst hs = [];\n\t\n\t\tfor (const elm of Array.from(cont.children)) {\n\t\t\tif (elm.tagName === tn) {\n\t\t\t\tconst id = `${prefix}${cid}-${hs.length + 1}`;\n\t\t\t\ths.push({ elm, id });\n\t\t\t}\n\t\t}\n\t\treturn hs;\n\t}\n\t\n\tfunction createBar(hs, curH, opts, activate) {\n\t\tconst ul = document.createElement('ul');\n\t\tul.id = curH.id;\n\t\tul.className = '';  // for Dummy\n\t\tsetClass(ul, opts.styleBar);\n\t\tif (activate) setClass(ul, opts.styleActive);\n\t\tconst as = [];\n\t\n\t\tfor (const h of hs) {\n\t\t\tconst a = createAnchor(h);\n\t\t\tconst li = document.createElement('li');\n\t\t\tif (h === curH) setClass(li, opts.styleCurrent);\n\t\t\tli.appendChild(a);\n\t\t\tul.appendChild(li);\n\t\t\tas.push(a);\n\t\t}\n\t\treturn { ul, as };\n\t}\n\t\n\t\n\t// -------------------------------------------------------------------------\n\t\n\t\n\tfunction assignEvent(inst, bars) {\n\t\tfor (const bar of bars) {\n\t\t\tbar.as.forEach((a, i) => {\n\t\t\t\ta.addEventListener('click', () => onClick(inst, bars[i].ul));\n\t\t\t});\n\t\t}\n\t\tonIntersect((vs) => {\n\t\t\tinst.vs = vs;\n\t\t\tupdate(inst);\n\t\t}, inst.uls, 0);\n\t}\n\t\n\tfunction onClick(inst, clicked) {\n\t\tinst.active = clicked;\n\t\tsetTimeout(() => {\n\t\t\tif (inst.active) {\n\t\t\t\tconst y = inst.active.getBoundingClientRect().top;\n\t\t\t\tinst.active = null;\n\t\t\t\tif (window.innerHeight < y) update(inst);\n\t\t\t}\n\t\t}, 1000);\n\t}\n\t\n\tfunction update(inst) {\n\t\tconst tar = inst.active ? inst.active : getFirstVisible(inst);\n\t\tfor (const ul of inst.uls) {\n\t\t\tsetClass(ul, inst.opts.styleActive, ul === tar);\n\t\t}\n\t}\n\t\n\tfunction getFirstVisible(inst) {\n\t\tif (!inst.vs) return null;\n\t\treturn inst.uls.find((ul, i) => inst.vs[i]);\n\t}\n\t\n\tNS.tabScroll = initialize;\n\n\t/**\n\t *\n\t * Style Class Utilities\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-11-11\n\t *\n\t */\n\t\n\t\n\tfunction hasClass(tar, cls) {\n\t\tconst key = cls.substr(1);\n\t\tif (cls.startsWith(':')) {\n\t\t\treturn tar.dataset[key] !== undefined;\n\t\t} else {\n\t\t\treturn tar.classList.contains(key);\n\t\t}\n\t}\n\t\n\tfunction setClass(tar, cls, enabled = true, val = '') {\n\t\tconst key = cls.substr(1);\n\t\tif (cls.startsWith(':')) {\n\t\t\tif (enabled) {\n\t\t\t\ttar.dataset[key] = val;\n\t\t\t} else {\n\t\t\t\tdelete tar.dataset[key];\n\t\t\t}\n\t\t} else {\n\t\t\tconst c = [key, val].join('-');\n\t\t\tif (enabled) {\n\t\t\t\ttar.classList.add(c);\n\t\t\t} else {\n\t\t\t\ttar.classList.remove(c);\n\t\t\t}\n\t\t}\n\t}\n\t\n\tfunction getSelector(cls) {\n\t\tif (cls.startsWith(':')) {\n\t\t\treturn `*[data-${cls.substr(1).replace(/([A-Z])/g, c => '-' + c.charAt(0).toLowerCase())}]`;\n\t\t} else {\n\t\t\treturn `*${cls}`;\n\t\t}\n\t}\n\t\n\t/**\n\t *\n\t * Utilities\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-11-17\n\t *\n\t */\n\t\n\t\n\tfunction getScrollOffset() {\n\t\tconst s = getComputedStyle(document.documentElement);\n\t\treturn parseInt(s.scrollPaddingTop);\n\t}\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tfunction throttle(fn) {\n\t\tlet isRunning;\n\t\treturn (...args) => {\n\t\t\tif (isRunning) return;\n\t\t\tisRunning = true;\n\t\t\trequestAnimationFrame(() => {\n\t\t\t\tisRunning = false;\n\t\t\t\tfn(...args);\n\t\t\t});\n\t\t};\n\t}\n\t\n\tconst resizeListeners = [];\n\t\n\tfunction onResize(fn, doFirst = false) {\n\t\tif (doFirst) fn();\n\t\tresizeListeners.push(throttle(fn));\n\t}\n\t\n\tdocument.addEventListener('DOMContentLoaded', () => {\n\t\twindow.addEventListener('resize', () => {\n\t\t\tfor (const l of resizeListeners) l();\n\t\t}, { passive: true });\n\t});\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tfunction onIntersect(fn, targets, threshold = 0, rootMargin = '* 0px 0px 0px') {\n\t\tconst vs = Array(targets.length).fill(false);\n\t\tconst tm = new Map();\n\t\ttargets.forEach((t, i) => tm.set(t, i));\n\t\n\t\tfunction init() {\n\t\t\tconst io = new IntersectionObserver((es) => {\n\t\t\t\tfor (const e of es) vs[tm.get(e.target)] = e.isIntersecting;\n\t\t\t\tfn(vs);\n\t\t\t}, { rootMargin: rootMargin.replace('*', `${mt}px`), threshold });\n\t\t\tfor (const t of targets) io.observe(t);\n\t\t\treturn io;\n\t\t}\n\t\tlet mt = 0;\n\t\tlet io = null;\n\t\tlet st = null;\n\t\tonResize(() => {\n\t\t\tmt = -getScrollOffset();\n\t\t\tif (st) clearTimeout(st);\n\t\t\tst = setTimeout(() => {\n\t\t\t\tif (io) io.disconnect();\n\t\t\t\tio = init();\n\t\t\t}, 100);\n\t\t}, true);\n\t}\n\t\n\t/**\n\t *\n\t * Common Functions\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-10-23\n\t *\n\t */\n\t\n\t\n\tfunction getFirstHeading(container) {\n\t\tconst cs = container.children;\n\t\tfor (let i = 0; i < cs.length; i += 1) {\n\t\t\tif (/^H[1-6]$/.test(cs[i].tagName)) return cs[i];\n\t\t}\n\t\treturn null;\n\t}\n\t\n\tfunction createAnchor(h) {\n\t\tconst a = document.createElement('a');\n\t\ta.href  = '#' + h.id;\n\t\ta.title = h.elm.innerText;\n\t\tconst t = h.elm.title ? h.elm.title : h.elm.innerHTML;\n\t\n\t\ta.innerHTML = t;\n\t\ta.querySelectorAll('small').forEach(e => e.remove());\n\t\tif (a.innerText === '') {\n\t\t\ta.innerHTML = t;\n\t\t}\n\t\tspanning(a);\n\t\treturn a;\n\t}\n\t\n\tfunction spanning(e) {\n\t\tfor (const c of Array.from(e.children)) {\n\t\t\tif (c.tagName === 'A' || c.tagName === 'SMALL') {\n\t\t\t\tconst s = document.createElement('span');\n\t\t\t\ts.innerHTML = c.innerHTML;\n\t\t\t\te.replaceChild(s, c);\n\t\t\t\tspanning(s);\n\t\t\t} else {\n\t\t\t\tspanning(c);\n\t\t\t}\n\t\t}\n\t}\n\t\n\n})(window['NACSS']);\n"]}