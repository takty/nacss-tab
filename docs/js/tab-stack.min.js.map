{"version":3,"sources":["tab-stack.js"],"names":["window","NS","onHashChanged","inst","idx","getCurrentPage","location","hash","getAnchorPage","setTimeout","update","create","cont","cid","opts","ps","bars","curIdx","hs","fh","container","cs","children","i","length","test","tagName","getFirstHeading","tn","curP","elm","Array","from","id","hashPrefix","push","document","createElement","doRemoveHeader","removeChild","appendChild","extractHeadersAndPages","bar0","createBar","bar1","insertBefore","ul","firstChild","p","bar","as","forEach","a","addEventListener","e","onClick","h","isAccordion","assignEvent","className","enableClass","styleBar","createAnchor","li","preventDefault","getComputedStyle","target","parentElement","pointerEvents","url","href","replace","history","pushState","ul0","ul1","r0","getBoundingClientRect","top","innerHeight","bottom","r1","scrollIntoView","behavior","scrollToTab","flexDirection","indexOf","re","RegExp","match","tar","getElementById","contains","a0","a1","styleCurrent","resize","style","minHeight","minH","marginBtm","parseInt","marginBottom","marginTop","height","mt","mb","Math","max","offsetHeight","getMinHeight","maxHeightRate","title","innerText","t","innerHTML","querySelectorAll","remove","spanning","c","s","replaceChild","enabled","cls","key","substr","startsWith","dataset","classList","add","tabStack","Object","assign","styleActive","is","onResize","resizeListeners","fn","doFirst","isRunning","args","requestAnimationFrame","throttle","l","passive"],"mappings":"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","file":"tab-stack.min.js","sourcesContent":["/**\n *\n * Tab Style - Stack (JS)\n *\n * @author Takuto Yanagida\n * @version 2021-10-19\n *\n */\n\n\nwindow['NACSS'] = window['NACSS'] || {};\n\n\n(function (NS) {\n\n\t/**\n\t *\n\t * Tab - Stack (JS)\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-10-22\n\t *\n\t */\n\t\n\t\n\tfunction initialize(cs, opts = {}) {\n\t\tif (cs.length === 0) return;\n\t\n\t\topts = Object.assign({\n\t\t\tstyleBar      : ':ncTabBar',\n\t\t\tstyleCurrent  : ':ncCurrent',\n\t\t\tstyleActive   : ':ncActive',\n\t\t\thashPrefix    : 'tst:',\n\t\t\tmaxHeightRate : 0.8,\n\t\t\tdoRemoveHeader: false,\n\t\t}, opts);\n\t\tconst is = [];\n\t\tfor (let i = 0; i < cs.length; i += 1) {\n\t\t\tconst inst = create(cs[i], i + 1, opts);\n\t\t\tif (inst) is.push(inst);\n\t\t}\n\t\tonResize(() => is.forEach(resize), true);\n\t\twindow.addEventListener('hashchange', () => is.forEach(onHashChanged) );\n\t}\n\t\n\tfunction onHashChanged(inst) {\n\t\tlet idx = getCurrentPage(inst, location.hash);\n\t\tif (idx === null) idx = getAnchorPage(inst, location.hash);\n\t\tif (idx !== null) setTimeout(() => update(inst, idx), 10);\n\t}\n\t\n\tfunction create(cont, cid, opts) {\n\t\tconst inst = {\n\t\t\topts,\n\t\t\tcont,\n\t\t\tps    : null,\n\t\t\tbars  : [],\n\t\t\tcurIdx: 0,\n\t\t};\n\t\tconst [hs, ps] = extractHeadersAndPages(cont, cid, opts);\n\t\tif (hs.length === 0) return false;\n\t\tinst.ps = ps;\n\t\n\t\tconst bar0 = createBar(hs, opts);\n\t\tconst bar1 = createBar(hs, opts);\n\t\tinst.bars.push(bar0, bar1);\n\t\n\t\tcont.insertBefore(bar0.ul, cont.firstChild);\n\t\tfor (const p of ps) cont.appendChild(p);\n\t\tcont.appendChild(bar1.ul);\n\t\n\t\tassignEvent(inst);\n\t\treturn inst;\n\t}\n\t\n\t\n\t// -------------------------------------------------------------------------\n\t\n\t\n\tfunction extractHeadersAndPages(cont, cid, opts) {\n\t\tconst fh = getFirstHeading(cont);\n\t\tif (!fh) return [];\n\t\tconst tn = fh.tagName;\n\t\tconst hs = [];\n\t\tconst ps = [];\n\t\tlet curP = null;\n\t\n\t\tfor (const elm of Array.from(cont.children)) {\n\t\t\tif (elm.tagName === tn) {\n\t\t\t\tconst id = `${opts.hashPrefix}${cid}-${hs.length + 1}`;\n\t\t\t\ths.push({ elm, id });\n\t\n\t\t\t\tif (curP) ps.push(curP);\n\t\t\t\tcurP = document.createElement('div');\n\t\t\t\tif (opts.doRemoveHeader) {\n\t\t\t\t\tcont.removeChild(elm);\n\t\t\t\t} else {\n\t\t\t\t\tcurP.appendChild(elm);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (curP) curP.appendChild(elm);\n\t\t\t}\n\t\t}\n\t\tif (curP) ps.push(curP);\n\t\treturn [hs, ps];\n\t}\n\t\n\tfunction createBar(hs, opts) {\n\t\tconst ul = document.createElement('ul');\n\t\tul.className = '';  // for Dummy\n\t\tenableClass(true, ul, opts.styleBar);\n\t\tconst as = [];\n\t\n\t\tfor (const h of hs) {\n\t\t\tconst a = createAnchor(h);\n\t\t\tconst li = document.createElement('li');\n\t\t\tli.appendChild(a);\n\t\t\tul.appendChild(li);\n\t\t\tas.push(a);\n\t\t}\n\t\treturn { ul, as };\n\t}\n\t\n\t\n\t// -------------------------------------------------------------------------\n\t\n\t\n\tfunction assignEvent(inst) {\n\t\tfor (const bar of inst.bars) {\n\t\t\tbar.as.forEach((a, i) => {\n\t\t\t\ta.addEventListener('click', (e) => onClick(e, inst, i));\n\t\t\t});\n\t\t}\n\t\tconst h = location.hash;\n\t\tlet idx = getCurrentPage(inst, h);\n\t\tif (idx === null) idx = getAnchorPage(inst, h);\n\t\tif (idx === null) idx = isAccordion(inst) ? -1 : 0;\n\t\tsetTimeout(() => update(inst, idx), 10);\n\t}\n\t\n\tfunction onClick(e, inst, idx) {\n\t\te.preventDefault();\n\t\tif (getComputedStyle(e.target.parentElement).pointerEvents === 'none') return;\n\t\tlet url = e.target.href;\n\t\tif (inst.curIdx === idx) {\n\t\t\tidx = -1;\n\t\t\turl = url.replace(/#.*$/, '');\n\t\t}\n\t\thistory.pushState({}, null, url);\n\t\tupdate(inst, idx);\n\t\tscrollToTab(inst);\n\t}\n\t\n\tfunction isAccordion(inst) {\n\t\treturn getComputedStyle(inst.bars[0].ul).flexDirection === 'column';\n\t}\n\t\n\tfunction scrollToTab(inst) {\n\t\tif (inst.curIdx === -1) return;\n\t\tsetTimeout(() => {\n\t\t\tconst [{ ul: ul0 }, { ul: ul1 }] = inst.bars;\n\t\t\tconst r0 = ul0.getBoundingClientRect();\n\t\t\tif (0 <= r0.top && r0.top <= window.innerHeight && 0 <= r0.bottom && r0.bottom <= window.innerHeight) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst r1 = ul1.getBoundingClientRect();\n\t\t\tif (isAccordion(inst) || (r1.top < 0 || window.innerHeight < r1.bottom)) {\n\t\t\t\tinst.cont.scrollIntoView({ behavior: 'smooth' });\n\t\t\t}\n\t\t}, 10);\n\t}\n\t\n\t\n\t// -------------------------------------------------------------------------\n\t\n\t\n\tfunction getCurrentPage(inst, hash) {\n\t\tif (hash.indexOf('#') === -1) return null;\n\t\tconst re = new RegExp(hash + '$', 'g');\n\t\tconst as = inst.bars[0].as;\n\t\tfor (let i = 0; i < as.length; i += 1) {\n\t\t\tif (as[i].href.match(re)) return i;\n\t\t}\n\t\treturn null;\n\t}\n\t\n\tfunction getAnchorPage(inst, hash) {\n\t\tconst id = hash.replace('#', '');\n\t\tconst tar = document.getElementById(id);\n\t\tif (!tar) return null;\n\t\tfor (let i = 0; i < inst.ps.length; i += 1) {\n\t\t\tif (inst.ps[i].contains(tar)) {\n\t\t\t\treturn i;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\t\n\t\n\t// -------------------------------------------------------------------------\n\t\n\t\n\tfunction update(inst, idx) {\n\t\tconst ps = inst.ps;\n\t\tconst [{ as: a0 }, { as: a1 }] = inst.bars;\n\t\n\t\tfor (let i = 0; i < ps.length; i += 1) {\n\t\t\tenableClass(i === idx, a0[i].parentElement, inst.opts.styleCurrent);\n\t\t\tenableClass(i === idx, a1[i].parentElement, inst.opts.styleCurrent);\n\t\t\tenableClass(i === idx, ps[i], inst.opts.styleCurrent);\n\t\t}\n\t\tinst.curIdx = idx;\n\t}\n\t\n\t\n\t// -------------------------------------------------------------------------\n\t\n\t\n\tfunction resize(inst) {\n\t\tconst cont = inst.cont;\n\t\tif (isAccordion(inst)) {\n\t\t\tcont.style.minHeight = '';\n\t\t} else {\n\t\t\tconst minH = getMinHeight(inst);\n\t\t\tconst h = (minH < window.innerHeight * inst.opts.maxHeightRate) ? `${minH}px` : '';\n\t\t\tcont.style.minHeight = h;\n\t\n\t\t\tif (inst.curIdx === -1) {\n\t\t\t\tupdate(inst, 0);\n\t\t\t}\n\t\t}\n\t}\n\t\n\tfunction getMinHeight(inst) {\n\t\tconst [{ ul: ul0 }, { ul: ul1 }] = inst.bars;\n\t\n\t\tlet marginBtm = parseInt(getComputedStyle(ul0).marginBottom);\n\t\tlet marginTop = parseInt(getComputedStyle(ul1).marginTop);\n\t\tlet height = 0;\n\t\n\t\tfor (const p of inst.ps) {\n\t\t\tconst ps = getComputedStyle(p);\n\t\t\tconst mt = parseInt(ps.marginTop);\n\t\t\tconst mb = parseInt(ps.marginBottom);\n\t\t\tconst h  = p.getBoundingClientRect().height;\n\t\n\t\t\tmarginBtm = Math.max(marginBtm, mt);\n\t\t\tmarginTop = Math.max(marginTop, mb);\n\t\t\theight    = Math.max(height, h);\n\t\t}\n\t\treturn ul0.offsetHeight + ul1.offsetHeight + marginBtm + marginTop + height;\n\t}\n\t\n\tNS.tabStack = initialize;\n\n\t/**\n\t *\n\t * Common Functions\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-10-23\n\t *\n\t */\n\t\n\t\n\tfunction getFirstHeading(container) {\n\t\tconst cs = container.children;\n\t\tfor (let i = 0; i < cs.length; i += 1) {\n\t\t\tif (/^H[1-6]$/.test(cs[i].tagName)) return cs[i];\n\t\t}\n\t\treturn null;\n\t}\n\t\n\tfunction createAnchor(h) {\n\t\tconst a = document.createElement('a');\n\t\ta.href  = '#' + h.id;\n\t\ta.title = h.elm.innerText;\n\t\tconst t = h.elm.title ? h.elm.title : h.elm.innerHTML;\n\t\n\t\ta.innerHTML = t;\n\t\ta.querySelectorAll('small').forEach(e => e.remove());\n\t\tif (a.innerText === '') {\n\t\t\ta.innerHTML = t;\n\t\t}\n\t\tspanning(a);\n\t\treturn a;\n\t}\n\t\n\tfunction spanning(e) {\n\t\tfor (const c of Array.from(e.children)) {\n\t\t\tif (c.tagName === 'A' || c.tagName === 'SMALL') {\n\t\t\t\tconst s = document.createElement('span');\n\t\t\t\ts.innerHTML = c.innerHTML;\n\t\t\t\te.replaceChild(s, c);\n\t\t\t\tspanning(s);\n\t\t\t} else {\n\t\t\t\tspanning(c);\n\t\t\t}\n\t\t}\n\t}\n\t\n\t/**\n\t *\n\t * Utilities\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-10-21\n\t *\n\t */\n\t\n\t\n\tfunction enableClass(enabled, tar, cls) {\n\t\tconst key = cls.substr(1);\n\t\tif (cls.startsWith(':')) {\n\t\t\tif (enabled) {\n\t\t\t\ttar.dataset[key] = '';\n\t\t\t} else {\n\t\t\t\tdelete tar.dataset[key];\n\t\t\t}\n\t\t} else {\n\t\t\tif (enabled) {\n\t\t\t\ttar.classList.add(key);\n\t\t\t} else {\n\t\t\t\ttar.classList.remove(key);\n\t\t\t}\n\t\n\t\t}\n\t}\n\t\n\tfunction throttle(fn) {\n\t\tlet isRunning;\n\t\treturn (...args) => {\n\t\t\tif (isRunning) return;\n\t\t\tisRunning = true;\n\t\t\trequestAnimationFrame(() => {\n\t\t\t\tisRunning = false;\n\t\t\t\tfn(...args);\n\t\t\t});\n\t\t};\n\t}\n\t\n\tconst resizeListeners = [];\n\t\n\tfunction onResize(fn, doFirst = false) {\n\t\tif (doFirst) fn();\n\t\tresizeListeners.push(throttle(fn));\n\t}\n\t\n\tdocument.addEventListener('DOMContentLoaded', () => {\n\t\twindow.addEventListener('resize', () => {\n\t\t\tfor (const l of resizeListeners) l();\n\t\t}, { passive: true });\n\t});\n\t\n\tfunction onIntersect(fn, doFirst = false, opts = {}) {\n\t\t// if (doFirst) fn();\n\t\topts['targets']      = opts['targets']      ?? [];\n\t\topts['marginTop']    = opts['marginTop']    ?? 0;\n\t\topts['marginLeft']   = opts['marginLeft']   ?? 0;\n\t\topts['marginRight']  = opts['marginRight']  ?? 0;\n\t\topts['marginBottom'] = opts['marginBottom'] ?? 0;\n\t\topts['threshold']    = opts['threshold']    ?? 1;\n\t\n\t\tobserveIntersection(fn, opts, opts['targets'].concat());\n\t}\n\t\n\tfunction observeIntersection(fn, os, ts) {\n\t\tfunction init() {\n\t\t\t// for workaround of rootMargin bug on Android Chrome\n\t\t\tconst r = 1;//(document.body.classList.contains('android') && NS.BROWSER === 'chrome') ? window.devicePixelRatio : 1;\n\t\t\tconst rootMargin = (mt * r) + 'px ' + (os.marginRight * r) + 'px ' + (os.marginBottom * r) + 'px ' + (os.marginLeft * r) + 'px';\n\t\t\tconst io = new IntersectionObserver((es) => {\n\t\t\t\tconst vs = Array.from(prevVs);\n\t\t\t\tfor (let i = 0; i < es.length; i += 1) vs[ts.indexOf(es[i].target)] = es[i].isIntersecting;\n\t\t\t\tif (!isMatch(vs, prevVs)) fn(vs);\n\t\t\t\tprevVs = vs;\n\t\t\t}, { rootMargin: rootMargin, threshold: os.threshold });\n\t\t\tfor (let i = 0; i < ts.length; i += 1) io.observe(ts[i]);\n\t\t\treturn io;\n\t\t}\n\t\tlet prevVs = Array(ts.length).fill(false);\n\t\tlet mt = os.marginTop;\n\t\tif (mt !== 'OFFSET') {\n\t\t\tinit();\n\t\t\treturn;\n\t\t}\n\t\tlet io = null;\n\t\tlet st = null;\n\t\t// const off = NS.makeOffsetFunction(true, true);  // Initialize here\n\t\tonResize(() => {\n\t\t\tmt = 0;//-off();\n\t\t\tif (st) clearTimeout(st);\n\t\t\tst = setTimeout(() => {\n\t\t\t\tif (io) io.disconnect();\n\t\t\t\tio = init();\n\t\t\t}, 100);\n\t\t}, true);\n\t}\n\t\n\tfunction isMatch(vs0, vs1) {\n\t\tif (vs1.length !== vs0.length) return false;\n\t\tfor (let i = 0; i < vs0.length; i += 1) {\n\t\t\tif (vs0[i] !== vs1[i]) return false;\n\t\t}\n\t\treturn true;\n\t}\n\n})(window['NACSS']);\n"]}