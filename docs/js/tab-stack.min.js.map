{"version":3,"sources":["tab-stack.js"],"names":["window","NS","setClass","tar","cls","enabled","val","key","substr","startsWith","dataset","c","join","classList","add","remove","resizeListeners","onResize","fn","doFirst","push","isRunning","args","requestAnimationFrame","throttle","onHashChanged","inst","idx","getCurrentByHash","location","hash","getAnchorPage","setTimeout","update","create","cont","cid","opts","ps","bars","curIdx","hs","fh","container","cs","children","i","length","test","tagName","getFirstHeading","tn","curP","elm","id","doUseHeadingId","hashPrefix","document","createElement","doRemoveHeading","removeChild","appendChild","extractHeadingsAndPages","bar0","createBar","bar1","insertBefore","ul","firstChild","p","bar","as","forEach","a","addEventListener","e","onClick","assignEvent","h","isVertical","indexOf","re","RegExp","href","match","replace","getElementById","findIndex","contains","className","styleBar","createAnchor","li","preventDefault","getComputedStyle","target","parentElement","pointerEvents","url","history","pushState","ul0","ul1","r0","getBoundingClientRect","top","innerHeight","bottom","r1","scrollIntoView","behavior","scrollToTab","undefined","hasClass","styleVertical","a0","a1","styleCurrent","resize","innerWidth","maxVerticalWidth","style","minHeight","minH","marginBtm","parseInt","marginBottom","marginTop","height","mt","mb","Math","max","offsetHeight","getMinHeight","maxHeightRate","title","innerText","t","innerHTML","querySelectorAll","spanning","s","replaceChild","l","passive","applyStack","Object","assign","styleActive","console","log","is"],"mappings":"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","file":"tab-stack.min.js","sourcesContent":["/**\n *\n * Tab Stack\n *\n * @author Takuto Yanagida\n * @version 2021-12-26\n *\n */\n\n\n'use strict';\n\nwindow['NACSS']        = window['NACSS']        || {};\nwindow['NACSS']['tab'] = window['NACSS']['tab'] || {};\n\n\n((NS) => {\n\n\t/**\n\t *\n\t * Style Class Utilities\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-11-11\n\t *\n\t */\n\t\n\t\n\tfunction hasClass(tar, cls) {\n\t\tconst key = cls.substr(1);\n\t\tif (cls.startsWith(':')) {\n\t\t\treturn tar.dataset[key] !== undefined;\n\t\t} else {\n\t\t\treturn tar.classList.contains(key);\n\t\t}\n\t}\n\t\n\tfunction setClass(tar, cls, enabled = true, val = '') {\n\t\tconst key = cls.substr(1);\n\t\tif (cls.startsWith(':')) {\n\t\t\tif (enabled) {\n\t\t\t\ttar.dataset[key] = val;\n\t\t\t} else {\n\t\t\t\tdelete tar.dataset[key];\n\t\t\t}\n\t\t} else {\n\t\t\tconst c = [key, val].join('-');\n\t\t\tif (enabled) {\n\t\t\t\ttar.classList.add(c);\n\t\t\t} else {\n\t\t\t\ttar.classList.remove(c);\n\t\t\t}\n\t\t}\n\t}\n\t\n\tfunction getSelector(cls) {\n\t\tif (cls.startsWith(':')) {\n\t\t\treturn `*[data-${cls.substr(1).replace(/([A-Z])/g, c => '-' + c.charAt(0).toLowerCase())}]`;\n\t\t} else {\n\t\t\treturn `*${cls}`;\n\t\t}\n\t}\n\t\n\t/**\n\t *\n\t * Utilities\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-12-06\n\t *\n\t */\n\t\n\t\n\tfunction getScrollOffset() {\n\t\tconst s   = getComputedStyle(document.documentElement);\n\t\tconst val = parseInt(s.scrollPaddingTop);\n\t\treturn Number.isNaN(val) ? 0 : val;\n\t}\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tfunction throttle(fn) {\n\t\tlet isRunning;\n\t\treturn (...args) => {\n\t\t\tif (isRunning) return;\n\t\t\tisRunning = true;\n\t\t\trequestAnimationFrame(() => {\n\t\t\t\tisRunning = false;\n\t\t\t\tfn(...args);\n\t\t\t});\n\t\t};\n\t}\n\t\n\tconst resizeListeners = [];\n\t\n\tfunction onResize(fn, doFirst = false) {\n\t\tif (doFirst) fn();\n\t\tresizeListeners.push(throttle(fn));\n\t}\n\t\n\tdocument.addEventListener('DOMContentLoaded', () => {\n\t\twindow.addEventListener('resize', () => {\n\t\t\tfor (const l of resizeListeners) l();\n\t\t}, { passive: true });\n\t});\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tfunction onIntersect(fn, targets, threshold = 0, rootMargin = '* 0px 0px 0px') {\n\t\tconst vs = Array(targets.length).fill(false);\n\t\tconst tm = new Map();\n\t\ttargets.forEach((t, i) => tm.set(t, i));\n\t\n\t\tfunction init() {\n\t\t\tconst io = new IntersectionObserver((es) => {\n\t\t\t\tfor (const e of es) vs[tm.get(e.target)] = e.isIntersecting;\n\t\t\t\tfn(vs);\n\t\t\t}, { rootMargin: rootMargin.replace('*', `${mt}px`), threshold });\n\t\t\tfor (const t of targets) io.observe(t);\n\t\t\treturn io;\n\t\t}\n\t\tlet mt = 0;\n\t\tlet io = null;\n\t\tlet st = null;\n\t\tonResize(() => {\n\t\t\tmt = -getScrollOffset();\n\t\t\tif (st) clearTimeout(st);\n\t\t\tst = setTimeout(() => {\n\t\t\t\tif (io) io.disconnect();\n\t\t\t\tio = init();\n\t\t\t}, 100);\n\t\t}, true);\n\t}\n\t\n\n\t/**\n\t *\n\t * Stack\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2022-10-26\n\t *\n\t */\n\t\n\t\n\tfunction apply(cs, opts = {}) {\n\t\tif (cs.length === 0) return;\n\t\n\t\topts = Object.assign({\n\t\t\tstyleBar        : ':ncTabBar',\n\t\t\tstyleCurrent    : ':ncCurrent',\n\t\t\tstyleActive     : ':ncActive',\n\t\t\tstyleVertical   : ':ncVertical',\n\t\t\thashPrefix      : 'tst:',\n\t\t\tmaxHeightRate   : 0.8,\n\t\t\tmaxVerticalWidth: 599.5,\n\t\t\tdoRemoveHeading : false,\n\t\t\tdoUseHeadingId  : false,\n\t\t}, opts);\n\t\tif (!opts.doRemoveHeading && opts.doUseHeadingId) {\n\t\t\topts.doUseHeadingId = false;\n\t\t\tconsole.log('nacss.tab.stack: \\'opts.doRemoveHeading\\' must be true when \\'opts.doUseHeadingId\\' is true');\n\t\t}\n\t\tconst is = [];\n\t\tfor (let i = 0; i < cs.length; i += 1) {\n\t\t\tconst inst = create(cs[i], i + 1, opts);\n\t\t\tif (inst) is.push(inst);\n\t\t}\n\t\tonResize(() => is.forEach(resize), true);\n\t\twindow.addEventListener('hashchange', () => is.forEach(onHashChanged) );\n\t\n\t\tsetTimeout(() => {\n\t\t\tconst id = location.hash.replace('#', '');\n\t\t\tif (id !== '') {\n\t\t\t\tconst tar = document.getElementById(id);\n\t\t\t\tif (tar) tar.scrollIntoView({ behavior: 'smooth' });\n\t\t\t}\n\t\t}, 10);\n\t}\n\t\n\tfunction onHashChanged(inst) {\n\t\tlet idx = getCurrentByHash(inst, location.hash);\n\t\tif (idx === null) idx = getAnchorPage(inst, location.hash);\n\t\tif (idx !== null) setTimeout(() => update(inst, idx), 10);\n\t}\n\t\n\t\n\t// -------------------------------------------------------------------------\n\t\n\t\n\tfunction create(cont, cid, opts) {\n\t\tconst inst = {\n\t\t\topts,\n\t\t\tcont,\n\t\t\tps    : null,\n\t\t\tbars  : [],\n\t\t\tcurIdx: 0,\n\t\t};\n\t\tconst [hs, ps] = extractHeadingsAndPages(cont, cid, opts);\n\t\tif (hs.length === 0) return false;\n\t\tinst.ps = ps;\n\t\n\t\tconst bar0 = createBar(hs, opts);\n\t\tconst bar1 = createBar(hs, opts);\n\t\tinst.bars.push(bar0, bar1);\n\t\n\t\tcont.insertBefore(bar0.ul, cont.firstChild);\n\t\tfor (const p of ps) cont.appendChild(p);\n\t\tcont.appendChild(bar1.ul);\n\t\n\t\tassignEvent(inst);\n\t\n\t\tconst h = location.hash;\n\t\tlet idx = getCurrentByHash(inst, h);\n\t\tif (idx === null) idx = getAnchorPage(inst, h);\n\t\tif (idx === null) idx = isVertical(inst) ? -1 : 0;\n\t\tsetTimeout(() => update(inst, idx), 10);\n\t\treturn inst;\n\t}\n\t\n\tfunction getCurrentByHash(inst, hash) {\n\t\tif (hash.indexOf('#') === -1) return null;\n\t\tconst re = new RegExp(hash + '$', 'g');\n\t\tconst as = inst.bars[0].as;\n\t\tfor (let i = 0; i < as.length; i += 1) {\n\t\t\tif (as[i].href.match(re)) return i;\n\t\t}\n\t\treturn null;\n\t}\n\t\n\tfunction getAnchorPage(inst, hash) {\n\t\tconst id = hash.replace('#', '');\n\t\tif (id !== '') {\n\t\t\tconst tar = document.getElementById(id);\n\t\t\tif (tar) {\n\t\t\t\tconst idx = inst.ps.findIndex(p => p.contains(tar));\n\t\t\t\tif (idx !== -1) return idx;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\t\n\t\n\t// -------------------------------------------------------------------------\n\t\n\t\n\tfunction extractHeadingsAndPages(cont, cid, opts) {\n\t\tconst fh = getFirstHeading(cont);\n\t\tif (!fh) return [];\n\t\tconst tn = fh.tagName;\n\t\tconst hs = [];\n\t\tconst ps = [];\n\t\tlet curP = null;\n\t\n\t\tfor (const elm of [...cont.children]) {\n\t\t\tif (elm.tagName === tn) {\n\t\t\t\tconst id = (opts.doUseHeadingId && elm.id) ? elm.id : `${opts.hashPrefix}${cid}-${hs.length + 1}`;\n\t\t\t\ths.push({ elm, id });\n\t\n\t\t\t\tif (curP) ps.push(curP);\n\t\t\t\tcurP = document.createElement('div');\n\t\t\t\tif (opts.doRemoveHeading) {\n\t\t\t\t\tcont.removeChild(elm);\n\t\t\t\t} else {\n\t\t\t\t\tcurP.appendChild(elm);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (curP) curP.appendChild(elm);\n\t\t\t}\n\t\t}\n\t\tif (curP) ps.push(curP);\n\t\treturn [hs, ps];\n\t}\n\t\n\tfunction createBar(hs, opts) {\n\t\tconst ul = document.createElement('ul');\n\t\tul.className = '';  // for Dummy\n\t\tsetClass(ul, opts.styleBar);\n\t\tconst as = [];\n\t\n\t\tfor (const h of hs) {\n\t\t\tconst a = createAnchor(h);\n\t\t\tconst li = document.createElement('li');\n\t\t\tli.appendChild(a);\n\t\t\tul.appendChild(li);\n\t\t\tas.push(a);\n\t\t}\n\t\treturn { ul, as };\n\t}\n\t\n\t\n\t// -------------------------------------------------------------------------\n\t\n\t\n\tfunction assignEvent(inst) {\n\t\tfor (const bar of inst.bars) {\n\t\t\tbar.as.forEach((a, i) => {\n\t\t\t\ta.addEventListener('click', (e) => onClick(e, inst, i));\n\t\t\t});\n\t\t}\n\t}\n\t\n\tfunction onClick(e, inst, idx) {\n\t\te.preventDefault();\n\t\tif (getComputedStyle(e.target.parentElement).pointerEvents === 'none') return;\n\t\tlet url = e.target.href;\n\t\tif (inst.curIdx === idx) {\n\t\t\tidx = -1;\n\t\t\turl = url.replace(/#.*$/, '');\n\t\t}\n\t\thistory.pushState({}, null, url);\n\t\tupdate(inst, idx);\n\t\tscrollToTab(inst);\n\t}\n\t\n\tfunction isVertical(inst) {\n\t\treturn hasClass(inst.cont, inst.opts.styleVertical);\n\t}\n\t\n\tfunction scrollToTab(inst) {\n\t\tif (inst.curIdx === -1) return;\n\t\tsetTimeout(() => {\n\t\t\tconst [{ ul: ul0 }, { ul: ul1 }] = inst.bars;\n\t\t\tconst r0 = ul0.getBoundingClientRect();\n\t\t\tif (0 <= r0.top && r0.top <= window.innerHeight && 0 <= r0.bottom && r0.bottom <= window.innerHeight) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst r1 = ul1.getBoundingClientRect();\n\t\t\tif (isVertical(inst) || (r1.top < 0 || window.innerHeight < r1.bottom)) {\n\t\t\t\tinst.cont.scrollIntoView({ behavior: 'smooth' });\n\t\t\t}\n\t\t}, 10);\n\t}\n\t\n\tfunction update(inst, idx) {\n\t\tconst ps = inst.ps;\n\t\tconst [{ as: a0 }, { as: a1 }] = inst.bars;\n\t\n\t\tfor (let i = 0; i < ps.length; i += 1) {\n\t\t\tsetClass(a0[i], inst.opts.styleCurrent, i === idx);\n\t\t\tsetClass(a1[i], inst.opts.styleCurrent, i === idx);\n\t\t\tsetClass(a0[i].parentElement, inst.opts.styleCurrent, i === idx);\n\t\t\tsetClass(a1[i].parentElement, inst.opts.styleCurrent, i === idx);\n\t\t\tsetClass(ps[i], inst.opts.styleCurrent, i === idx);\n\t\t}\n\t\tinst.curIdx = idx;\n\t}\n\t\n\t\n\t// -------------------------------------------------------------------------\n\t\n\t\n\tfunction resize(inst) {\n\t\tconst cont = inst.cont;\n\t\tsetClass(cont, inst.opts.styleVertical, window.innerWidth <= inst.opts.maxVerticalWidth);\n\t\n\t\tif (isVertical(inst)) {\n\t\t\tcont.style.minHeight = '';\n\t\t} else {\n\t\t\tconst minH = getMinHeight(inst);\n\t\t\tconst h = (minH < window.innerHeight * inst.opts.maxHeightRate) ? `${minH}px` : '';\n\t\t\tcont.style.minHeight = h;\n\t\n\t\t\tif (inst.curIdx === -1) {\n\t\t\t\tupdate(inst, 0);\n\t\t\t}\n\t\t}\n\t}\n\t\n\tfunction getMinHeight(inst) {\n\t\tconst [{ ul: ul0 }, { ul: ul1 }] = inst.bars;\n\t\n\t\tlet marginBtm = parseInt(getComputedStyle(ul0).marginBottom);\n\t\tlet marginTop = parseInt(getComputedStyle(ul1).marginTop);\n\t\tlet height = 0;\n\t\n\t\tfor (const p of inst.ps) {\n\t\t\tconst ps = getComputedStyle(p);\n\t\t\tconst mt = parseInt(ps.marginTop);\n\t\t\tconst mb = parseInt(ps.marginBottom);\n\t\t\tconst h  = p.getBoundingClientRect().height;\n\t\n\t\t\tmarginBtm = Math.max(marginBtm, mt);\n\t\t\tmarginTop = Math.max(marginTop, mb);\n\t\t\theight    = Math.max(height, h);\n\t\t}\n\t\treturn ul0.offsetHeight + ul1.offsetHeight + marginBtm + marginTop + height;\n\t}\n\t\n\tNS.applyStack = apply;\n\n\t/**\n\t *\n\t * Common Functions\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2022-01-07\n\t *\n\t */\n\t\n\t\n\tfunction getFirstHeading(container) {\n\t\tconst cs = container.children;\n\t\tfor (let i = 0; i < cs.length; i += 1) {\n\t\t\tif (/^H[1-6]$/.test(cs[i].tagName)) return cs[i];\n\t\t}\n\t\treturn null;\n\t}\n\t\n\tfunction createAnchor(h) {\n\t\tconst a = document.createElement('a');\n\t\ta.href  = '#' + h.id;\n\t\ta.title = h.elm.innerText;\n\t\tconst t = h.elm.title ? h.elm.title : h.elm.innerHTML;\n\t\n\t\ta.innerHTML = t;\n\t\ta.querySelectorAll('small').forEach(e => e.remove());\n\t\tif (a.innerText === '') {\n\t\t\ta.innerHTML = t;\n\t\t}\n\t\tspanning(a);\n\t\treturn a;\n\t}\n\t\n\tfunction spanning(e) {\n\t\tfor (const c of [...e.children]) {\n\t\t\tif (c.tagName === 'A' || c.tagName === 'SMALL') {\n\t\t\t\tconst s = document.createElement('span');\n\t\t\t\ts.innerHTML = c.innerHTML;\n\t\t\t\te.replaceChild(s, c);\n\t\t\t\tspanning(s);\n\t\t\t} else {\n\t\t\t\tspanning(c);\n\t\t\t}\n\t\t}\n\t}\n\t\n\n})(window['NACSS']['tab']);\n"]}